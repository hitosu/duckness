{"version":3,"file":"store.js","names":["selectAll","value","always","whenChanged","a","b","createStore","updateStore","updater","nextStore","refStore","current","listeners","forEach","listener","shouldSelect","nextValue","selector","shouldUpdate","prevValue","useStore","updateOnMount","updateOnUnmount","debounce","useState","setValue","debounceDuration","useRef","debounceTimer","useEffect","clearTimeout","setTimeout","add","delete","initState","actions","Set","boundActions","Object","keys","actionName","args","store","apply","freeze","Consumer","props","children","getState","subscribe","destroy","clear"],"sources":["../src/store.js"],"sourcesContent":["import { useEffect, useState, useRef } from 'react'\n\nexport function selectAll(value) {\n  return value\n}\n\nexport function always() {\n  return true\n}\n\nexport function whenChanged(a, b) {\n  return a !== b\n}\n\nexport default function createStore({ initState = {}, actions = {} } = {}) {\n  const refStore = {\n    current: initState\n  }\n\n  const listeners = new Set()\n\n  function updateStore(updater) {\n    const nextStore = updater(refStore.current)\n    listeners.forEach(function (listener) {\n      if (listener.shouldSelect && !listener.shouldSelect(nextStore, refStore.current)) {\n        return\n      }\n      const nextValue = listener.selector ? listener.selector(nextStore) : nextStore\n      if (null == listener.shouldUpdate || listener.shouldUpdate(nextValue, listener.prevValue)) {\n        listener(nextValue)\n        if (null != listener.shouldUpdate) {\n          listener.prevValue = nextValue\n        }\n      }\n    })\n    refStore.current = nextStore\n    return refStore.current\n  }\n\n  function useStore({\n    updateOnMount,\n    updateOnUnmount,\n    selector,\n    shouldSelect,\n    shouldUpdate = whenChanged,\n    debounce\n  } = {}) {\n    const [value, setValue] = useState(function () {\n      return selector(updateOnMount ? updateStore(updateOnMount) : refStore.current)\n    })\n\n    const debounceDuration = useRef()\n    debounceDuration.current = debounce\n    const debounceTimer = useRef()\n\n    useEffect(function () {\n      const listener = function (nextValue) {\n        if (debounceTimer.current) {\n          clearTimeout(debounceTimer.current)\n        }\n        if (null == debounceDuration.current) {\n          setValue(nextValue)\n        } else {\n          debounceTimer.current = setTimeout(function () {\n            debounceTimer.current = null\n            setValue(nextValue)\n          }, debounceDuration.current)\n        }\n      }\n      listener.selector = selector\n      listener.shouldSelect = shouldSelect\n      listener.shouldUpdate = shouldUpdate\n      listeners.add(listener)\n      return function () {\n        if (updateOnUnmount) updateStore(updateOnUnmount)\n        listeners.delete(listener)\n      }\n    }, [])\n\n    return value\n  }\n\n  function Consumer(props) {\n    const value = useStore({\n      updateOnMount: props.updateOnMount,\n      updateOnUnmount: props.updateOnUnmount,\n      selector: props.selector,\n      shouldSelect: props.shouldSelect,\n      shouldUpdate: props.shouldUpdate,\n      debounce: props.debounce\n    })\n\n    return props.children(value)\n  }\n\n  const boundActions = {}\n  Object.keys(actions).forEach(function (actionName) {\n    boundActions[actionName] = function (...args) {\n      updateStore(function (store) {\n        return actions[actionName].apply(store, args) || store\n      })\n    }\n  })\n\n  function destroy() {\n    listeners.clear()\n  }\n\n  function subscribe(listener) {\n    listeners.add(listener)\n    return function () {\n      listeners.delete(listener)\n    }\n  }\n\n  function getState(selector) {\n    return selector ? selector(refStore.current) : refStore.current\n  }\n\n  return Object.freeze({\n    useStore,\n    Consumer,\n    actions: boundActions,\n    updateStore,\n    getState,\n    subscribe,\n    destroy\n  })\n}\n"],"mappings":"aAAA,4BAAmD,k5CAE5C,QAASA,UAAS,CAACC,CAAK,CAAE,CAC/B,MAAOA,EACT,CAEO,QAASC,OAAM,EAAG,CACvB,QACF,CAEO,QAASC,YAAW,CAACC,CAAC,CAAEC,CAAC,CAAE,CAChC,MAAOD,EAAC,GAAKC,CACf,CAEe,QAASC,YAAW,EAAwC,CAOzE,QAASC,EAAW,CAACC,CAAO,CAAE,CAC5B,GAAMC,EAAS,CAAGD,CAAO,CAACE,CAAQ,CAACC,OAAO,CAAC,CAc3C,MAbAC,EAAS,CAACC,OAAO,CAAC,SAAUC,CAAQ,CAAE,CACpC,GAAI,CAAAA,CAAQ,CAACC,YAAY,EAAKD,CAAQ,CAACC,YAAY,CAACN,CAAS,CAAEC,CAAQ,CAACC,OAAO,CAAC,EAGhF,GAAMK,EAAS,CAAGF,CAAQ,CAACG,QAAQ,CAAGH,CAAQ,CAACG,QAAQ,CAACR,CAAS,CAAC,CAAGA,CAAS,EAC1E,IAAI,EAAIK,CAAQ,CAACI,YAAY,EAAIJ,CAAQ,CAACI,YAAY,CAACF,CAAS,CAAEF,CAAQ,CAACK,SAAS,CAAC,IACvFL,CAAQ,CAACE,CAAS,CAAC,CACf,IAAI,EAAIF,CAAQ,CAACI,YAAY,GAC/BJ,CAAQ,CAACK,SAAS,CAAGH,CAAS,GAGpC,CAAC,CAAC,CACFN,CAAQ,CAACC,OAAO,CAAGF,CAAS,CACrBC,CAAQ,CAACC,OAClB,CAEA,QAASS,EAAQ,EAOT,8DAAJ,CAAC,CAAC,CANJC,CAAa,GAAbA,aAAa,CACbC,CAAe,GAAfA,eAAe,CACfL,CAAQ,GAARA,QAAQ,CACRF,CAAY,GAAZA,YAAY,KACZG,YAAY,CAAZA,CAAY,YAAGf,WAAW,GAC1BoB,CAAQ,GAARA,QAAQ,GAEkB,GAAAC,eAAQ,EAAC,UAAY,CAC7C,MAAOP,EAAQ,CAACI,CAAa,CAAGd,CAAW,CAACc,CAAa,CAAC,CAAGX,CAAQ,CAACC,OAAO,CAC/E,CAAC,CAAC,uBAFKV,CAAK,MAAEwB,CAAQ,MAIhBC,CAAgB,CAAG,GAAAC,aAAM,GAAE,CACjCD,CAAgB,CAACf,OAAO,CAAGY,CAAQ,CACnC,GAAMK,EAAa,CAAG,GAAAD,aAAM,GAAE,CA0B9B,MAxBA,GAAAE,gBAAS,EAAC,UAAY,CACpB,GAAMf,EAAQ,CAAG,SAAUE,CAAS,CAAE,CAChCY,CAAa,CAACjB,OAAO,EACvBmB,YAAY,CAACF,CAAa,CAACjB,OAAO,CAAC,CAEjC,IAAI,EAAIe,CAAgB,CAACf,OAAO,CAClCc,CAAQ,CAACT,CAAS,CAAC,CAEnBY,CAAa,CAACjB,OAAO,CAAGoB,UAAU,CAAC,UAAY,CAC7CH,CAAa,CAACjB,OAAO,CAAG,IAAI,CAC5Bc,CAAQ,CAACT,CAAS,CACpB,CAAC,CAAEU,CAAgB,CAACf,OAAO,CAE/B,CAAC,CAKD,MAJAG,EAAQ,CAACG,QAAQ,CAAGA,CAAQ,CAC5BH,CAAQ,CAACC,YAAY,CAAGA,CAAY,CACpCD,CAAQ,CAACI,YAAY,CAAGA,CAAY,CACpCN,CAAS,CAACoB,GAAG,CAAClB,CAAQ,CAAC,CAChB,UAAY,CACbQ,CAAe,EAAEf,CAAW,CAACe,CAAe,CAAC,CACjDV,CAAS,CAACqB,MAAM,CAACnB,CAAQ,CAC3B,CACF,CAAC,CAAE,EAAE,CAAC,CAECb,CACT,CAAC,6DAlEoE,CAAC,CAAC,KAAnCiC,SAAS,CAATA,CAAS,YAAG,CAAC,CAAC,OAAEC,OAAO,CAAPA,CAAO,YAAG,CAAC,CAAC,GAC1DzB,CAAQ,CAAG,CACfC,OAAO,CAAEuB,CACX,CAAC,CAEKtB,CAAS,CAAG,GAAIwB,IAAK,CA4ErBC,CAAY,CAAG,CAAC,CAAC,CAwBvB,MAvBAC,OAAM,CAACC,IAAI,CAACJ,CAAO,CAAC,CAACtB,OAAO,CAAC,SAAU2B,CAAU,CAAE,CACjDH,CAAY,CAACG,CAAU,CAAC,CAAG,UAAmB,4BAANC,CAAI,sBAAJA,CAAI,iBAC1ClC,CAAW,CAAC,SAAUmC,CAAK,CAAE,CAC3B,MAAOP,EAAO,CAACK,CAAU,CAAC,CAACG,KAAK,CAACD,CAAK,CAAED,CAAI,CAAC,EAAIC,CACnD,CAAC,CACH,CACF,CAAC,CAAC,CAiBKJ,MAAM,CAACM,MAAM,CAAC,CACnBxB,QAAQ,CAARA,CAAQ,CACRyB,QAAQ,CAvCV,SAAkBC,CAAK,CAAE,CACvB,GAAM7C,EAAK,CAAGmB,CAAQ,CAAC,CACrBC,aAAa,CAAEyB,CAAK,CAACzB,aAAa,CAClCC,eAAe,CAAEwB,CAAK,CAACxB,eAAe,CACtCL,QAAQ,CAAE6B,CAAK,CAAC7B,QAAQ,CACxBF,YAAY,CAAE+B,CAAK,CAAC/B,YAAY,CAChCG,YAAY,CAAE4B,CAAK,CAAC5B,YAAY,CAChCK,QAAQ,CAAEuB,CAAK,CAACvB,QAClB,CAAC,CAAC,CAEF,MAAOuB,EAAK,CAACC,QAAQ,CAAC9C,CAAK,CAC7B,CA4BU,CACRkC,OAAO,CAAEE,CAAY,CACrB9B,WAAW,CAAXA,CAAW,CACXyC,QAAQ,CATV,SAAkB/B,CAAQ,CAAE,CAC1B,MAAOA,EAAQ,CAAGA,CAAQ,CAACP,CAAQ,CAACC,OAAO,CAAC,CAAGD,CAAQ,CAACC,OAC1D,CAOU,CACRsC,SAAS,CAjBX,SAAmBnC,CAAQ,CAAE,CAE3B,MADAF,EAAS,CAACoB,GAAG,CAAClB,CAAQ,CAAC,CAChB,UAAY,CACjBF,CAAS,CAACqB,MAAM,CAACnB,CAAQ,CAC3B,CACF,CAYW,CACToC,OAAO,CAtBT,UAAmB,CACjBtC,CAAS,CAACuC,KAAK,EACjB,CAqBA,CAAC,CACH"}