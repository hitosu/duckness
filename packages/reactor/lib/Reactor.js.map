{"version":3,"sources":["../src/Reactor.js"],"names":["Reactor","state","isRunning","reactions","Set","subscriptions","Map","addReagents","addReactions","addRuntime","addSubscriptions","Object","defineProperty","value","reagent","reagentType","type","has","listeners","get","i","length","writable","enumerable","reactionGenerator","reaction","add","delete","forEach","currentValue","onDone","takeEvery","listener","set","Error","stopTaking"],"mappings":"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","sourcesContent":["import runReactorReaction from './runtime/runReaction'\nimport stopReactorReaction from './runtime/stopReaction'\nimport Reaction from './Reaction'\n\nexport default function Reactor() {\n  const state = {\n    isRunning: false,\n    reactions: new Set(),\n    subscriptions: new Map()\n  }\n\n  const Reactor = {}\n  addReagents(Reactor, state)\n  addReactions(Reactor, state)\n  addRuntime(Reactor, state)\n  addSubscriptions(Reactor, state)\n\n  return Reactor\n}\n\nfunction addReagents(Reactor, state) {\n  function put(reagent) {\n    if (state.isRunning) {\n      const { type: reagentType } = reagent\n      if (state.subscriptions.has(reagentType)) {\n        const listeners = [...state.subscriptions.get(reagentType)]\n        for (let i = 0; i < listeners.length; i++) {\n          listeners[i](reagent)\n        }\n      }\n    }\n  }\n\n  Object.defineProperty(Reactor, 'put', { value: put, writable: false, enumerable: true })\n}\n\nfunction addReactions(Reactor, state) {\n  function addReaction(reactionGenerator) {\n    const reaction = Reaction(reactionGenerator)\n    state.reactions.add(reaction)\n    if (state.isRunning) {\n      runReactorReaction(reaction, Reactor, void 0)\n    }\n    return () => {\n      if (reaction.isRunning) {\n        stopReactorReaction(reaction, Reactor)\n      }\n      state.reactions.delete(reaction)\n    }\n  }\n\n  Object.defineProperty(Reactor, 'addReaction', { value: addReaction, writable: false, enumerable: true })\n}\n\nfunction addRuntime(Reactor, state) {\n  function runReaction(reaction, currentValue, onDone) {\n    return runReactorReaction(reaction, Reactor, currentValue, onDone)\n  }\n\n  function stopReaction(reaction) {\n    return stopReactorReaction(reaction, Reactor)\n  }\n\n  function run() {\n    if (!state.isRunning) {\n      state.isRunning = true\n      const reactions = [...state.reactions]\n      for (let i = 0; i < reactions.length; i++) {\n        const reaction = reactions[i]\n        if (reaction.isRunning) {\n          stopReactorReaction(reaction, Reactor)\n        }\n        runReactorReaction(reaction, Reactor, void 0)\n      }\n      return true\n    } else {\n      return false\n    }\n  }\n\n  function stop() {\n    if (state.isRunning) {\n      state.isRunning = false\n      state.reactions.forEach(reaction => {\n        if (reaction.isRunning) {\n          stopReactorReaction(reaction, Reactor)\n        }\n      })\n      return true\n    } else {\n      return false\n    }\n  }\n\n  Object.defineProperty(Reactor, 'run', { value: run, writable: false, enumerable: true })\n  Object.defineProperty(Reactor, 'stop', { value: stop, writable: false, enumerable: true })\n  Object.defineProperty(Reactor, 'isRunning', {\n    get() {\n      return state.isRunning\n    },\n    enumerable: true\n  })\n  Object.defineProperty(Reactor, 'runReaction', {\n    value: runReaction,\n    writable: false,\n    enumerable: true\n  })\n  Object.defineProperty(Reactor, 'stopReaction', { value: stopReaction, writable: false, enumerable: true })\n}\n\nfunction addSubscriptions(Reactor, state) {\n  function takeEvery(reagentType, listener) {\n    if ('function' === typeof listener) {\n      if (!state.subscriptions.has(reagentType)) {\n        state.subscriptions.set(reagentType, new Set())\n      }\n      state.subscriptions.get(reagentType).add(listener)\n      return () => {\n        if (state.subscriptions.has(reagentType) && state.subscriptions.get(reagentType).has(listener)) {\n          state.subscriptions.get(reagentType).delete(listener)\n          return true\n        } else {\n          return false\n        }\n      }\n    } else {\n      throw new Error('Reactor.takeEvery: listener should be a Function')\n    }\n  }\n\n  function take(reagentType, listener) {\n    if ('function' === typeof listener) {\n      const stopTaking = takeEvery(reagentType, reagent => {\n        stopTaking()\n        listener(reagent)\n      })\n    } else {\n      throw new Error('Reactor.take: listener should be a Function')\n    }\n  }\n\n  Object.defineProperty(Reactor, 'takeEvery', { value: takeEvery, writable: false, enumerable: true })\n  Object.defineProperty(Reactor, 'take', { value: take, writable: false, enumerable: true })\n}\n"],"file":"Reactor.js"}