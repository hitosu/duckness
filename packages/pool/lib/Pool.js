"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=Pool;var _react=_interopRequireDefault(require("react")),_reactDom=_interopRequireDefault(require("react-dom")),_redux=require("redux"),_reactRedux=require("react-redux"),_reduxSaga=_interopRequireDefault(require("redux-saga")),_effects=require("redux-saga/effects");function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function Pool(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},b=a.ducks,c=void 0===b?[]:b,d=a.buildStore,e=void 0===d?function(){return{}}:d,f=a.buildRootReducer,g=a.buildRootSaga,h=a.renderRoot,i=void 0===h?function(){return null}:h,j={props:{},ducks:c||[],addDuck:function addDuck(a){j.ducks.push(a)},errorReporter:console.error,setErrorReporter:function setErrorReporter(a){j.errorReporter=a},build:function build(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:j.props;j.props=a||{},k.rootReducer=f?f(j.ducks):k.defaultRootReducer;var b="object"===("undefined"==typeof window?"undefined":_typeof(window))&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__({}):_redux.compose,c=b((0,_redux.applyMiddleware)(l.sagaMiddleware));k.store=(0,_redux.createStore)(k.rootReducer,e?e(j.props)||{}:{},c),l.rootSaga=g?g(j.ducks):l.defaultRootSaga,l.sagaMiddleware.run(l.rootSaga)},render:function render(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:j.props;return j.props=a||{},null==k.store&&j.build(j.props),_react.default.createElement(_reactRedux.Provider,{store:k.store},i(j.props))},start:function start(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:j.props,b=1<arguments.length?arguments[1]:void 0;j.build(a),m.mount(b)},stop:function stop(){m.unmount(),k.store=null}},k={store:null,defaultRootReducer:function defaultRootReducer(a,b){return j.ducks.reduce(function(a,c){try{return c(a,b)}catch(b){return"function"==typeof j.errorReporter&&j.errorReporter("@duckness/pool",c.duckName,"reducer",b),a}},a)}},l={sagaMiddleware:(0,_reduxSaga.default)(),defaultRootSaga:regeneratorRuntime.mark(function defaultRootSaga(){var a;return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return a=j.ducks.reduce(function(a,b){return b.rootSaga&&(b.errorReporter(j.errorReporter),a.push((0,_effects.spawn)(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=1,a.next=4,(0,_effects.call)(b.rootSaga);case 4:return a.abrupt("break",12);case 7:a.prev=7,a.t0=a["catch"](1),"function"==typeof j.errorReporter&&j.errorReporter("@duckness/pool",b.duckName,"saga",a.t0);case 10:a.next=0;break;case 12:case"end":return a.stop();}},a,null,[[1,7]])})))),a},[]),b.next=3,(0,_effects.all)(a);case 3:case"end":return b.stop();}},defaultRootSaga)})},m={mountedTo:null,mount:function mount(a){a&&(null!=m.mountedTo&&a!==m.mountedTo&&m.unmount(),m.mountedTo=a,_reactDom.default.render(j.render(),m.mountedTo))},unmount:function unmount(){m.mountedTo&&(_reactDom.default.unmountComponentAtNode(m.mountedTo),m.mountedTo=null)}};return{addDuck:j.addDuck,start:j.start,stop:j.stop,build:j.build,render:j.render,mount:m.mount,unmount:m.unmount,errorReporter:j.setErrorReporter}}
//# sourceMappingURL=Pool.js.map