{"version":3,"sources":["../src/Pool.js"],"names":["initDucksStream","Object","freeze","afterBuild","refStore","refDucks","refProps","current","forEach","duck","dispatch","type","mapActionType","payload","mapDuck","map","poolName","duckName","Pool","reportError","refErrorReporter","getDuckByName","duckPath","Array","isArray","duckPoolName","getDispatchActionFromDispatchArgs","args","length","actionName","actionArgs","error","Error","actionCreator","action","build","props","refReducers","root","buildRootReducer","state","preState","pre","ducksReducedState","reduce","dispatchedAction","post","refStreams","stream","beforeBuild","composeEnhancers","window","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","x","middlewares","streamMiddlewares","concat","refMiddlewares","enhancer","applyMiddleware","buildStore","initProps","ducks","initDucks","initMiddlewares","streams","initStreams","console","pool","defineProperty","value","push","writable","enumerable","middleware","unshift","reducer","reporter","get","selector","getState","resolver","Promise","resolve","reject","prevSelectedValue","resolved","unsubscribe","resolveValue","tryResolve","currentState","selectedValue","subscribe","callback","stateOrAction","andAction"],"mappings":"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","sourcesContent":["import { createStore, applyMiddleware } from 'redux'\n\n// this pool stream will send @@INIT action to every registered duck after build\nconst initDucksStream = Object.freeze({\n  afterBuild({ refStore, refDucks, refProps } = {}) {\n    refDucks.current.forEach(duck => {\n      refStore.current.dispatch({ type: duck.mapActionType('@@INIT'), payload: refProps.current })\n    })\n  }\n})\n\nfunction mapDuck(map = {}, duck) {\n  const { poolName, duckName } = duck\n  if (null != poolName && null != duckName) {\n    if (null == map[poolName]) {\n      map[poolName] = {}\n    }\n    map[poolName][duckName] = duck\n  }\n  return map\n}\n\n// POOL\nexport default function Pool({\n  poolName = 'pool',\n  props: initProps = {},\n  ducks: initDucks = [],\n  middlewares: initMiddlewares = [],\n  streams: initStreams = [],\n  buildStore = () => {\n    return {}\n  },\n  buildRootReducer\n} = {}) {\n  const refProps = { current: initProps || {} }\n  const refDucks = { current: initDucks || [], map: (initDucks || []).reduce((map, duck) => mapDuck(map, duck), {}) }\n  const refStreams = { current: [...(initStreams || []), initDucksStream] }\n  const refMiddlewares = { current: initMiddlewares || [] }\n  const refErrorReporter = { current: ('undefined' !== typeof console && console.error) || (() => {}) } // eslint-disable-line no-console\n\n  function addDuck(duck) {\n    refDucks.current.push(duck)\n    refDucks.map = mapDuck(refDucks.map, duck)\n  }\n\n  function addMiddleware(middleware) {\n    refMiddlewares.current.push(middleware)\n  }\n\n  function addStream(stream) {\n    refStreams.current.unshift(stream)\n  }\n\n  function setErrorReporter(reporter) {\n    refErrorReporter.current = reporter\n  }\n\n  function reportError(...args) {\n    if ('function' === typeof refErrorReporter.current) {\n      refErrorReporter.current(...args)\n    }\n  }\n\n  const refStore = { current: null }\n\n  function getDuckByName(duckPath) {\n    if ('string' === typeof duckPath || Array.isArray(duckPath)) {\n      const [duckPoolName, duckName] = 'string' === typeof duckPath ? [poolName, duckPath] : [duckPath[0], duckPath[1]]\n      return refDucks.map[duckPoolName] ? refDucks.map[duckPoolName][duckName] : null\n    } else {\n      return null\n    }\n  }\n  function getDispatchActionFromDispatchArgs(args) {\n    // dispatch(action)\n    // dispatch(duckName, actionName, ...actionArgs)\n    // dispatch([poolName, duckName], actionName, ...actionArgs)\n    if (1 === args.length) {\n      return args[0]\n    } else if (args.length > 1) {\n      const [duckPath, actionName, ...actionArgs] = args\n      const duck = getDuckByName(duckPath)\n      if (null == duck) {\n        const error = new Error(`Received action '${actionName}' dispatch but duck '${duckPath}' is not found`)\n        error.actionName = actionName\n        error.duckPath = duckPath\n        reportError(error, '@duckness/pool', 'dispatch')\n        return null\n      } else {\n        const actionCreator = duck.action[actionName]\n        if (null == actionCreator) {\n          const error = new Error(\n            `Received action dispatch but action '${actionName}' for duck '${duckPath}' is not found`\n          )\n          error.actionName = actionName\n          error.duckPath = duckPath\n          reportError(error, '@duckness/pool', 'dispatch')\n          return null\n        } else {\n          return actionCreator(...actionArgs)\n        }\n      }\n    } else {\n      return null\n    }\n  }\n  function dispatch(...args) {\n    const action = getDispatchActionFromDispatchArgs(args)\n    if (null == action) {\n      const error = new Error('Received action dispatch without action')\n      error.poolName = poolName\n      reportError(error, '@duckness/pool', 'dispatch')\n    } else {\n      if (refStore.current) {\n        return refStore.current.dispatch(action)\n      } else {\n        const error = new Error('Received action dispatch but pool is not built yet')\n        error.dispatchedAction = action\n        error.poolName = poolName\n        reportError(error, '@duckness/pool', 'dispatch', action)\n      }\n    }\n    return void 0\n  }\n\n  const refReducers = { root: null, pre: null, post: null }\n  function reduce(stateOrAction, andAction) {\n    if (void 0 === andAction && !refStore.current) {\n      const error = new Error('Reducing state but pool is not built yet')\n      error.dispatchedAction = stateOrAction\n      error.poolName = poolName\n      reportError(error, '@duckness/pool', 'reduce', stateOrAction)\n      return stateOrAction\n    }\n    const state = void 0 === andAction ? refStore.current.getState() : stateOrAction\n    const action = void 0 === andAction ? stateOrAction : andAction\n    if (refReducers.root) {\n      return refReducers.root(state, action)\n    } else {\n      const error = new Error('Reducing state but pool is not built yet')\n      error.dispatchedAction = action\n      error.poolName = poolName\n      reportError(error, '@duckness/pool', 'reduce', action)\n      return state\n    }\n  }\n\n  function select(selector) {\n    if (refStore.current) {\n      return 'function' === typeof selector ? selector(refStore.current.getState()) : refStore.current.getState()\n    } else {\n      return void 0\n    }\n  }\n\n  function fetch(selector, resolver) {\n    return new Promise((resolve, reject) => {\n      if (refStore.current) {\n        let prevSelectedValue = void 0\n        let resolved = false\n        let unsubscribe = void 0\n        const resolveValue = value => {\n          if (unsubscribe) {\n            unsubscribe()\n          }\n          resolved = true\n          resolve(value)\n        }\n        const tryResolve = currentState => {\n          const selectedValue = 'function' === typeof selector ? selector(currentState) : currentState\n          if ('function' === typeof resolver) {\n            resolver(selectedValue, resolveValue, prevSelectedValue)\n            prevSelectedValue = selectedValue\n          } else if (void 0 !== selectedValue) {\n            resolveValue(selectedValue)\n          }\n        }\n        tryResolve(refStore.current.getState())\n        if (!resolved) {\n          unsubscribe = refStore.current.subscribe(() => {\n            tryResolve(refStore.current.getState())\n          })\n        }\n      } else {\n        const error = new Error('Fetching state but pool is not built yet')\n        error.poolName = poolName\n        reportError(error, '@duckness/pool', 'fetch')\n        reject(error)\n      }\n    })\n  }\n\n  function trigger(selector, callback, resolver) {\n    if (refStore.current) {\n      let prevSelectedValue = void 0\n      const tryResolve = currentState => {\n        const selectedValue = 'function' === typeof selector ? selector(currentState) : currentState\n        if ('function' === typeof resolver) {\n          resolver(selectedValue, callback, prevSelectedValue)\n          prevSelectedValue = selectedValue\n        } else if (prevSelectedValue !== selectedValue) {\n          callback(selectedValue)\n        }\n      }\n      tryResolve(refStore.current.getState())\n      return refStore.current.subscribe(() => {\n        tryResolve(refStore.current.getState())\n      })\n    } else {\n      const error = new Error('Fetching state but pool is not built yet')\n      error.poolName = poolName\n      reportError(error, '@duckness/pool', 'trigger')\n      return void 0\n    }\n  }\n\n  function setPreReducer(reducer) {\n    refReducers.pre = (state, action) => {\n      try {\n        return reducer(state, action)\n      } catch (error) {\n        try {\n          error.dispatchedAction = action\n          error.poolName = poolName\n        } catch {\n          // skip\n        }\n        reportError(error, '@duckness/pool', 'pre reducer')\n        return state\n      }\n    }\n  }\n  function setPostReducer(reducer) {\n    refReducers.post = (state, action) => {\n      try {\n        return reducer(state, action)\n      } catch (error) {\n        try {\n          error.dispatchedAction = action\n          error.poolName = poolName\n        } catch {\n          // skip\n        }\n        reportError(error, '@duckness/pool', 'post reducer')\n        return state\n      }\n    }\n  }\n\n  function build(props = refProps.current) {\n    // save props\n    refProps.current = props || {}\n\n    // build root reducer\n    refReducers.root = buildRootReducer\n      ? buildRootReducer(refDucks.current, { refProps, refReducers, refDucks, refErrorReporter })\n      : function defaultRootReducer(state, action) {\n          // pre reducer\n          const preState = refReducers.pre ? refReducers.pre(state, action) : state\n          // duck reducers\n          const ducksReducedState = refDucks.current.reduce((state, duck) => {\n            try {\n              return duck(state, action)\n            } catch (error) {\n              try {\n                error.poolName = poolName\n                error.duckPoolName = duck.poolName\n                error.duckName = duck.duckName\n                error.dispatchedAction = action\n              } catch {\n                // skip\n              }\n              reportError(error, '@duckness/pool', 'reducer', duck.poolName, duck.duckName)\n              return state\n            }\n          }, preState)\n          // post reducer\n          return refReducers.post ? refReducers.post(ducksReducedState, action) : ducksReducedState\n        }\n\n    // invoke beforeBuild for each pool stream\n    refStreams.current.forEach(stream => {\n      if (stream.beforeBuild) stream.beforeBuild({ refDucks, refProps, refReducers, refErrorReporter })\n    })\n\n    // compose redux middlewares\n    const composeEnhancers =\n      typeof window === 'object' && window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__\n        ? window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__({})\n        : x => x\n    const middlewares = [\n      ...refStreams.current.reduce(\n        (streamMiddlewares, stream) =>\n          stream.middlewares\n            ? streamMiddlewares.concat(stream.middlewares({ refDucks, refProps, refReducers, refErrorReporter }) || [])\n            : streamMiddlewares,\n        []\n      ),\n      ...refMiddlewares.current\n    ]\n    const enhancer = composeEnhancers(applyMiddleware(...middlewares))\n\n    // create store\n    refStore.current = createStore(\n      refReducers.root,\n      buildStore ? buildStore(refProps.current, { refProps, refDucks, refReducers, refErrorReporter }) || {} : {},\n      enhancer\n    )\n\n    // invoke afterBuild for each pool stream\n    refStreams.current.forEach(stream => {\n      if (stream.afterBuild) stream.afterBuild({ refStore, refDucks, refProps, refReducers, refErrorReporter })\n    })\n\n    // return redux store\n    return refStore.current\n  }\n\n  const pool = {}\n\n  Object.defineProperty(pool, 'addDuck', { value: addDuck, writable: false, enumerable: true })\n  Object.defineProperty(pool, 'addMiddleware', { value: addMiddleware, writable: false, enumerable: true })\n  Object.defineProperty(pool, 'addStream', { value: addStream, writable: false, enumerable: true })\n  Object.defineProperty(pool, 'preReducer', { value: setPreReducer, writable: false, enumerable: true })\n  Object.defineProperty(pool, 'postReducer', { value: setPostReducer, writable: false, enumerable: true })\n  Object.defineProperty(pool, 'build', { value: build, writable: false, enumerable: true })\n  Object.defineProperty(pool, 'reportError', { value: reportError, writable: false, enumerable: true })\n  Object.defineProperty(pool, 'setErrorReporter', { value: setErrorReporter, writable: false, enumerable: true })\n  Object.defineProperty(pool, 'store', {\n    get() {\n      return refStore.current\n    },\n    enumerable: true\n  })\n  Object.defineProperty(pool, 'dispatch', { value: dispatch, writable: false, enumerable: true })\n  Object.defineProperty(pool, 'select', { value: select, writable: false, enumerable: true })\n  Object.defineProperty(pool, 'fetch', { value: fetch, writable: false, enumerable: true })\n  Object.defineProperty(pool, 'trigger', { value: trigger, writable: false, enumerable: true })\n  Object.defineProperty(pool, 'reduce', { value: reduce, writable: false, enumerable: true })\n  Object.defineProperty(pool, 'ducks', {\n    get() {\n      return [...(refDucks.current || [])]\n    },\n    enumerable: true\n  })\n  Object.defineProperty(pool, 'getDuckByName', { value: getDuckByName, writable: false, enumerable: true })\n  Object.defineProperty(pool, 'middlewares', {\n    get() {\n      return [...(refMiddlewares.current || [])]\n    },\n    enumerable: true\n  })\n  Object.defineProperty(pool, 'streams', {\n    get() {\n      return [...(refStreams.current || [])]\n    },\n    enumerable: true\n  })\n  Object.defineProperty(pool, 'props', {\n    get() {\n      return { ...(refProps.current || {}) }\n    },\n    enumerable: true\n  })\n\n  return pool\n}\n"],"file":"Pool.js"}