{"version":3,"file":"Pool.js","names":["initDucksStream","Object","freeze","afterBuild","refStore","refDucks","refProps","current","forEach","duck","dispatch","type","mapActionType","payload","mapDuck","map","poolName","duckName","Pool","reportError","refErrorReporter","getDuckByName","duckPath","Array","isArray","duckPoolName","getDispatchActionFromDispatchArgs","args","length","actionName","actionArgs","error","Error","actionCreator","action","props","initProps","ducks","initDucks","middlewares","initMiddlewares","streams","initStreams","buildStore","buildRootReducer","reduce","refStreams","refMiddlewares","console","refReducers","root","pre","post","pool","defineProperty","value","addDuck","push","writable","enumerable","addMiddleware","middleware","addStream","stream","unshift","setPreReducer","reducer","state","dispatchedAction","setPostReducer","build","defaultRootReducer","preState","ducksReducedState","beforeBuild","composeEnhancers","window","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","x","streamMiddlewares","concat","enhancer","applyMiddleware","createStore","setErrorReporter","reporter","get","select","selector","getState","fetch","resolver","Promise","resolve","reject","prevSelectedValue","resolved","unsubscribe","resolveValue","tryResolve","currentState","selectedValue","subscribe","trigger","callback","stateOrAction","andAction"],"sources":["../src/Pool.js"],"sourcesContent":["import { createStore, applyMiddleware } from 'redux'\n\n// this pool stream will send @@INIT action to every registered duck after build\nconst initDucksStream = Object.freeze({\n  afterBuild({ refStore, refDucks, refProps } = {}) {\n    refDucks.current.forEach(duck => {\n      refStore.current.dispatch({ type: duck.mapActionType('@@INIT'), payload: refProps.current })\n    })\n  }\n})\n\nfunction mapDuck(map = {}, duck) {\n  const { poolName, duckName } = duck\n  if (null != poolName && null != duckName) {\n    if (null == map[poolName]) {\n      map[poolName] = {}\n    }\n    map[poolName][duckName] = duck\n  }\n  return map\n}\n\n// POOL\nexport default function Pool({\n  poolName = 'pool',\n  props: initProps = {},\n  ducks: initDucks = [],\n  middlewares: initMiddlewares = [],\n  streams: initStreams = [],\n  buildStore = () => {\n    return {}\n  },\n  buildRootReducer\n} = {}) {\n  const refProps = { current: initProps || {} }\n  const refDucks = { current: initDucks || [], map: (initDucks || []).reduce((map, duck) => mapDuck(map, duck), {}) }\n  const refStreams = { current: [...(initStreams || []), initDucksStream] }\n  const refMiddlewares = { current: initMiddlewares || [] }\n  const refErrorReporter = { current: ('undefined' !== typeof console && console.error) || (() => {}) } // eslint-disable-line no-console\n\n  function addDuck(duck) {\n    refDucks.current.push(duck)\n    refDucks.map = mapDuck(refDucks.map, duck)\n  }\n\n  function addMiddleware(middleware) {\n    refMiddlewares.current.push(middleware)\n  }\n\n  function addStream(stream) {\n    refStreams.current.unshift(stream)\n  }\n\n  function setErrorReporter(reporter) {\n    refErrorReporter.current = reporter\n  }\n\n  function reportError(...args) {\n    if ('function' === typeof refErrorReporter.current) {\n      refErrorReporter.current(...args)\n    }\n  }\n\n  const refStore = { current: null }\n\n  function getDuckByName(duckPath) {\n    if ('string' === typeof duckPath || Array.isArray(duckPath)) {\n      const [duckPoolName, duckName] = 'string' === typeof duckPath ? [poolName, duckPath] : [duckPath[0], duckPath[1]]\n      return refDucks.map[duckPoolName] ? refDucks.map[duckPoolName][duckName] : null\n    } else {\n      return null\n    }\n  }\n  function getDispatchActionFromDispatchArgs(args) {\n    // dispatch(action)\n    // dispatch(duckName, actionName, ...actionArgs)\n    // dispatch([poolName, duckName], actionName, ...actionArgs)\n    if (1 === args.length) {\n      return args[0]\n    } else if (args.length > 1) {\n      const [duckPath, actionName, ...actionArgs] = args\n      const duck = getDuckByName(duckPath)\n      if (null == duck) {\n        const error = new Error(`Received action '${actionName}' dispatch but duck '${duckPath}' is not found`)\n        error.actionName = actionName\n        error.duckPath = duckPath\n        reportError(error, '@duckness/pool', 'dispatch')\n        return null\n      } else {\n        const actionCreator = duck.action[actionName]\n        if (null == actionCreator) {\n          const error = new Error(\n            `Received action dispatch but action '${actionName}' for duck '${duckPath}' is not found`\n          )\n          error.actionName = actionName\n          error.duckPath = duckPath\n          reportError(error, '@duckness/pool', 'dispatch')\n          return null\n        } else {\n          return actionCreator(...actionArgs)\n        }\n      }\n    } else {\n      return null\n    }\n  }\n  function dispatch(...args) {\n    const action = getDispatchActionFromDispatchArgs(args)\n    if (null == action) {\n      const error = new Error('Received action dispatch without action')\n      error.poolName = poolName\n      reportError(error, '@duckness/pool', 'dispatch')\n    } else {\n      if (refStore.current) {\n        return refStore.current.dispatch(action)\n      } else {\n        const error = new Error('Received action dispatch but pool is not built yet')\n        error.dispatchedAction = action\n        error.poolName = poolName\n        reportError(error, '@duckness/pool', 'dispatch', action)\n      }\n    }\n    return void 0\n  }\n\n  const refReducers = { root: null, pre: null, post: null }\n  function reduce(stateOrAction, andAction) {\n    if (void 0 === andAction && !refStore.current) {\n      const error = new Error('Reducing state but pool is not built yet')\n      error.dispatchedAction = stateOrAction\n      error.poolName = poolName\n      reportError(error, '@duckness/pool', 'reduce', stateOrAction)\n      return stateOrAction\n    }\n    const state = void 0 === andAction ? refStore.current.getState() : stateOrAction\n    const action = void 0 === andAction ? stateOrAction : andAction\n    if (refReducers.root) {\n      return refReducers.root(state, action)\n    } else {\n      const error = new Error('Reducing state but pool is not built yet')\n      error.dispatchedAction = action\n      error.poolName = poolName\n      reportError(error, '@duckness/pool', 'reduce', action)\n      return state\n    }\n  }\n\n  function select(selector) {\n    if (refStore.current) {\n      return 'function' === typeof selector ? selector(refStore.current.getState()) : refStore.current.getState()\n    } else {\n      return void 0\n    }\n  }\n\n  function fetch(selector, resolver) {\n    return new Promise((resolve, reject) => {\n      if (refStore.current) {\n        let prevSelectedValue = void 0\n        let resolved = false\n        let unsubscribe = void 0\n        const resolveValue = value => {\n          if (unsubscribe) {\n            unsubscribe()\n          }\n          resolved = true\n          resolve(value)\n        }\n        const tryResolve = currentState => {\n          const selectedValue = 'function' === typeof selector ? selector(currentState) : currentState\n          if ('function' === typeof resolver) {\n            resolver(selectedValue, resolveValue, prevSelectedValue)\n            prevSelectedValue = selectedValue\n          } else if (void 0 !== selectedValue) {\n            resolveValue(selectedValue)\n          }\n        }\n        tryResolve(refStore.current.getState())\n        if (!resolved) {\n          unsubscribe = refStore.current.subscribe(() => {\n            tryResolve(refStore.current.getState())\n          })\n        }\n      } else {\n        const error = new Error('Fetching state but pool is not built yet')\n        error.poolName = poolName\n        reportError(error, '@duckness/pool', 'fetch')\n        reject(error)\n      }\n    })\n  }\n\n  function trigger(selector, callback, resolver) {\n    if (refStore.current) {\n      let prevSelectedValue = void 0\n      const tryResolve = currentState => {\n        const selectedValue = 'function' === typeof selector ? selector(currentState) : currentState\n        if ('function' === typeof resolver) {\n          resolver(selectedValue, callback, prevSelectedValue)\n          prevSelectedValue = selectedValue\n        } else if (prevSelectedValue !== selectedValue) {\n          callback(selectedValue)\n        }\n      }\n      tryResolve(refStore.current.getState())\n      return refStore.current.subscribe(() => {\n        tryResolve(refStore.current.getState())\n      })\n    } else {\n      const error = new Error('Fetching state but pool is not built yet')\n      error.poolName = poolName\n      reportError(error, '@duckness/pool', 'trigger')\n      return void 0\n    }\n  }\n\n  function setPreReducer(reducer) {\n    refReducers.pre = (state, action) => {\n      try {\n        return reducer(state, action)\n      } catch (error) {\n        try {\n          error.dispatchedAction = action\n          error.poolName = poolName\n        } catch {\n          // skip\n        }\n        reportError(error, '@duckness/pool', 'pre reducer')\n        return state\n      }\n    }\n  }\n  function setPostReducer(reducer) {\n    refReducers.post = (state, action) => {\n      try {\n        return reducer(state, action)\n      } catch (error) {\n        try {\n          error.dispatchedAction = action\n          error.poolName = poolName\n        } catch {\n          // skip\n        }\n        reportError(error, '@duckness/pool', 'post reducer')\n        return state\n      }\n    }\n  }\n\n  function build(props = refProps.current) {\n    // save props\n    refProps.current = props || {}\n\n    // build root reducer\n    refReducers.root = buildRootReducer\n      ? buildRootReducer(refDucks.current, { refProps, refReducers, refDucks, refErrorReporter })\n      : function defaultRootReducer(state, action) {\n          // pre reducer\n          const preState = refReducers.pre ? refReducers.pre(state, action) : state\n          // duck reducers\n          const ducksReducedState = refDucks.current.reduce((state, duck) => {\n            try {\n              return duck(state, action)\n            } catch (error) {\n              try {\n                error.poolName = poolName\n                error.duckPoolName = duck.poolName\n                error.duckName = duck.duckName\n                error.dispatchedAction = action\n              } catch {\n                // skip\n              }\n              reportError(error, '@duckness/pool', 'reducer', duck.poolName, duck.duckName)\n              return state\n            }\n          }, preState)\n          // post reducer\n          return refReducers.post ? refReducers.post(ducksReducedState, action) : ducksReducedState\n        }\n\n    // invoke beforeBuild for each pool stream\n    refStreams.current.forEach(stream => {\n      if (stream.beforeBuild) stream.beforeBuild({ refDucks, refProps, refReducers, refErrorReporter })\n    })\n\n    // compose redux middlewares\n    const composeEnhancers =\n      typeof window === 'object' && window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__\n        ? window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__({})\n        : x => x\n    const middlewares = [\n      ...refStreams.current.reduce(\n        (streamMiddlewares, stream) =>\n          stream.middlewares\n            ? streamMiddlewares.concat(stream.middlewares({ refDucks, refProps, refReducers, refErrorReporter }) || [])\n            : streamMiddlewares,\n        []\n      ),\n      ...refMiddlewares.current\n    ]\n    const enhancer = composeEnhancers(applyMiddleware(...middlewares))\n\n    // create store\n    refStore.current = createStore(\n      refReducers.root,\n      buildStore ? buildStore(refProps.current, { refProps, refDucks, refReducers, refErrorReporter }) || {} : {},\n      enhancer\n    )\n\n    // invoke afterBuild for each pool stream\n    refStreams.current.forEach(stream => {\n      if (stream.afterBuild) stream.afterBuild({ refStore, refDucks, refProps, refReducers, refErrorReporter })\n    })\n\n    // return redux store\n    return refStore.current\n  }\n\n  const pool = {}\n\n  Object.defineProperty(pool, 'addDuck', { value: addDuck, writable: false, enumerable: true })\n  Object.defineProperty(pool, 'addMiddleware', { value: addMiddleware, writable: false, enumerable: true })\n  Object.defineProperty(pool, 'addStream', { value: addStream, writable: false, enumerable: true })\n  Object.defineProperty(pool, 'preReducer', { value: setPreReducer, writable: false, enumerable: true })\n  Object.defineProperty(pool, 'postReducer', { value: setPostReducer, writable: false, enumerable: true })\n  Object.defineProperty(pool, 'build', { value: build, writable: false, enumerable: true })\n  Object.defineProperty(pool, 'reportError', { value: reportError, writable: false, enumerable: true })\n  Object.defineProperty(pool, 'setErrorReporter', { value: setErrorReporter, writable: false, enumerable: true })\n  Object.defineProperty(pool, 'store', {\n    get() {\n      return refStore.current\n    },\n    enumerable: true\n  })\n  Object.defineProperty(pool, 'dispatch', { value: dispatch, writable: false, enumerable: true })\n  Object.defineProperty(pool, 'select', { value: select, writable: false, enumerable: true })\n  Object.defineProperty(pool, 'fetch', { value: fetch, writable: false, enumerable: true })\n  Object.defineProperty(pool, 'trigger', { value: trigger, writable: false, enumerable: true })\n  Object.defineProperty(pool, 'reduce', { value: reduce, writable: false, enumerable: true })\n  Object.defineProperty(pool, 'ducks', {\n    get() {\n      return [...(refDucks.current || [])]\n    },\n    enumerable: true\n  })\n  Object.defineProperty(pool, 'getDuckByName', { value: getDuckByName, writable: false, enumerable: true })\n  Object.defineProperty(pool, 'middlewares', {\n    get() {\n      return [...(refMiddlewares.current || [])]\n    },\n    enumerable: true\n  })\n  Object.defineProperty(pool, 'streams', {\n    get() {\n      return [...(refStreams.current || [])]\n    },\n    enumerable: true\n  })\n  Object.defineProperty(pool, 'props', {\n    get() {\n      return { ...(refProps.current || {}) }\n    },\n    enumerable: true\n  })\n\n  return pool\n}\n"],"mappings":"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"}