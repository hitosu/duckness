{"version":3,"sources":["../src/Pool.js"],"names":["Pool","reportError","refErrorReporter","current","build","props","refProps","rootReducer","buildRootReducer","refDucks","state","action","reduce","duck","error","poolName","duckName","refStreams","forEach","stream","beforeBuild","composeEnhancers","window","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","x","middlewares","streamMiddlewares","concat","refMiddlewares","enhancer","applyMiddleware","refStore","buildStore","afterBuild","dispatch","type","mapActionType","payload","initProps","ducks","initDucks","initMiddlewares","streams","initStreams","console","pool","Object","defineProperty","value","push","writable","enumerable","middleware","reporter","get"],"mappings":"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","sourcesContent":["import { createStore, applyMiddleware } from 'redux'\n\nexport default function Pool({\n  props: initProps = {},\n  ducks: initDucks = [],\n  middlewares: initMiddlewares = [],\n  streams: initStreams = [],\n  buildStore = () => {\n    return {}\n  },\n  buildRootReducer\n} = {}) {\n  const refProps = { current: initProps || {} }\n  const refDucks = { current: initDucks || [] }\n  const refStreams = { current: initStreams || [] }\n  const refMiddlewares = { current: initMiddlewares || [] }\n  const refErrorReporter = { current: ('undefined' !== typeof console && console.error) || (() => {}) } // eslint-disable-line no-console\n\n  function addDuck(duck) {\n    refDucks.current.push(duck)\n  }\n\n  function addMiddleware(middleware) {\n    refMiddlewares.current.push(middleware)\n  }\n\n  function addStream(stream) {\n    refStreams.current.push(stream)\n  }\n\n  function setErrorReporter(reporter) {\n    refErrorReporter.current = reporter\n  }\n\n  function reportError(...args) {\n    if ('function' === typeof refErrorReporter.current) {\n      refErrorReporter.current(...args)\n    }\n  }\n\n  const refStore = { current: null }\n\n  function build(props = refProps.current) {\n    // save props\n    refProps.current = props || {}\n\n    // build root reducer\n    const rootReducer = buildRootReducer\n      ? buildRootReducer(refDucks.current, { refDucks, refErrorReporter })\n      : function defaultRootReducer(state, action) {\n          return refDucks.current.reduce((state, duck) => {\n            try {\n              return duck(state, action)\n            } catch (error) {\n              reportError(error, '@duckness/pool', 'reducer', duck.poolName, duck.duckName)\n              return state\n            }\n          }, state)\n        }\n\n    // invoke beforeBuild for each pool stream\n    refStreams.current.forEach(stream => {\n      if (stream.beforeBuild) stream.beforeBuild({ refDucks, refErrorReporter })\n    })\n\n    // compose redux middlewares\n    const composeEnhancers =\n      typeof window === 'object' && window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__\n        ? window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__({})\n        : x => x\n    const middlewares = [\n      ...refStreams.current.reduce(\n        (streamMiddlewares, stream) =>\n          stream.middlewares\n            ? streamMiddlewares.concat(stream.middlewares({ refDucks, refErrorReporter }) || [])\n            : streamMiddlewares,\n        []\n      ),\n      ...refMiddlewares.current\n    ]\n    const enhancer = composeEnhancers(applyMiddleware(...middlewares))\n\n    // create store\n    refStore.current = createStore(\n      rootReducer,\n      buildStore ? buildStore(refProps.current, { refProps, refDucks, refErrorReporter }) || {} : {},\n      enhancer\n    )\n\n    // invoke afterBuild for each pool stream\n    refStreams.current.forEach(stream => {\n      if (stream.afterBuild) stream.afterBuild({ refStore, refDucks, refErrorReporter })\n    })\n\n    // run @@INIT actions for each duck after store is built\n    refDucks.current.forEach(duck => {\n      refStore.current.dispatch({ type: duck.mapActionType('@@INIT'), payload: refProps.current })\n    })\n\n    // return redux store\n    return refStore.current\n  }\n\n  const pool = {}\n\n  Object.defineProperty(pool, 'addDuck', { value: addDuck, writable: false, enumerable: true })\n  Object.defineProperty(pool, 'addMiddleware', { value: addMiddleware, writable: false, enumerable: true })\n  Object.defineProperty(pool, 'addStream', { value: addStream, writable: false, enumerable: true })\n  Object.defineProperty(pool, 'build', { value: build, writable: false, enumerable: true })\n  Object.defineProperty(pool, 'reportError', { value: reportError, writable: false, enumerable: true })\n  Object.defineProperty(pool, 'setErrorReporter', { value: setErrorReporter, writable: false, enumerable: true })\n  Object.defineProperty(pool, 'store', {\n    get() {\n      return refStore.current\n    },\n    enumerable: true\n  })\n  Object.defineProperty(pool, 'ducks', {\n    get() {\n      return [...(refDucks.current || [])]\n    },\n    enumerable: true\n  })\n  Object.defineProperty(pool, 'middlewares', {\n    get() {\n      return [...(refMiddlewares.current || [])]\n    },\n    enumerable: true\n  })\n  Object.defineProperty(pool, 'streams', {\n    get() {\n      return [...(refStreams.current || [])]\n    },\n    enumerable: true\n  })\n  Object.defineProperty(pool, 'props', {\n    get() {\n      return { ...(refProps.current || {}) }\n    },\n    enumerable: true\n  })\n\n  return pool\n}\n"],"file":"Pool.js"}