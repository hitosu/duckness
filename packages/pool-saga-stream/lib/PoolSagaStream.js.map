{"version":3,"file":"PoolSagaStream.js","names":["PoolSagaStream","buildRootSaga","sagaMiddleware","createSagaMiddleware","Object","defineProperty","value","middlewares","writable","enumerable","beforeBuild","afterBuild","refDucks","refErrorReporter","rootSaga","current","defaultRootSaga","sagas","reduce","duck","setErrorReporter","push","spawn","call","poolName","duckName","all","run"],"sources":["../src/PoolSagaStream.js"],"sourcesContent":["import createSagaMiddleware from 'redux-saga'\nimport { spawn, call, all } from 'redux-saga/effects'\n\nexport default function PoolSagaStream({ buildRootSaga } = {}) {\n  const sagaMiddleware = createSagaMiddleware()\n\n  function middlewares() {\n    return [sagaMiddleware]\n  }\n\n  function beforeBuild() {\n    // NOP\n  }\n\n  function afterBuild({ refDucks, refErrorReporter } = {}) {\n    const rootSaga = buildRootSaga\n      ? buildRootSaga(refDucks.current, { refDucks, refErrorReporter })\n      : function* defaultRootSaga() {\n          const sagas = refDucks.current.reduce((sagas, duck) => {\n            if (duck.rootSaga) {\n              duck.setErrorReporter(refErrorReporter.current)\n              sagas.push(\n                spawn(function* () {\n                  while (true) {\n                    try {\n                      yield call(duck.rootSaga)\n                      break\n                    } catch (error) {\n                      refErrorReporter.current(\n                        error,\n                        '@duckness/pool-saga-stream',\n                        'saga',\n                        duck.poolName,\n                        duck.duckName\n                      )\n                    }\n                  }\n                })\n              )\n            }\n            return sagas\n          }, [])\n          yield all(sagas)\n        }\n\n    sagaMiddleware.run(rootSaga)\n  }\n\n  const PoolSagaStream = {}\n\n  Object.defineProperty(PoolSagaStream, 'middlewares', { value: middlewares, writable: false, enumerable: true })\n  Object.defineProperty(PoolSagaStream, 'beforeBuild', { value: beforeBuild, writable: false, enumerable: true })\n  Object.defineProperty(PoolSagaStream, 'afterBuild', { value: afterBuild, writable: false, enumerable: true })\n\n  return PoolSagaStream\n}\n"],"mappings":"2iOAGe,QAASA,eAAc,EAAyB,8DAAJ,CAAC,CAAC,CAApBC,CAAa,GAAbA,aAAa,CAC9CC,CAAc,CAAG,GAAAC,kBAAoB,GAAE,CA4CvCH,CAAc,CAAG,CAAC,CAAC,CAMzB,MAJAI,OAAM,CAACC,cAAc,CAACL,CAAc,CAAE,aAAa,CAAE,CAAEM,KAAK,CA5C5D,QAASC,EAAW,EAAG,CACrB,MAAO,CAACL,CAAc,CACxB,CA0CyE,CAAEM,QAAQ,GAAO,CAAEC,UAAU,GAAO,CAAC,CAAC,CAC/GL,MAAM,CAACC,cAAc,CAACL,CAAc,CAAE,aAAa,CAAE,CAAEM,KAAK,CAzC5D,QAASI,EAAW,EAAG,CAEvB,CAuCyE,CAAEF,QAAQ,GAAO,CAAEC,UAAU,GAAO,CAAC,CAAC,CAC/GL,MAAM,CAACC,cAAc,CAACL,CAAc,CAAE,YAAY,CAAE,CAAEM,KAAK,CAtC3D,QAASK,EAAU,EAAsC,8DAAJ,CAAC,CAAC,CAAjCC,CAAQ,GAARA,QAAQ,CAAEC,CAAgB,GAAhBA,gBAAgB,CACxCC,CAAQ,CAAGb,CAAa,CAC1BA,CAAa,CAACW,CAAQ,CAACG,OAAO,CAAE,CAAEH,QAAQ,CAARA,CAAQ,CAAEC,gBAAgB,CAAhBA,CAAiB,CAAC,CAAC,4BAC/D,QAAUG,EAAe,8FAyBvB,MAxBMC,EAAK,CAAGL,CAAQ,CAACG,OAAO,CAACG,MAAM,CAAC,SAACD,CAAK,CAAEE,CAAI,CAAK,CAsBrD,MArBIA,EAAI,CAACL,QAAQ,GACfK,CAAI,CAACC,gBAAgB,CAACP,CAAgB,CAACE,OAAO,CAAC,CAC/CE,CAAK,CAACI,IAAI,CACR,GAAAC,cAAK,6BAAC,kGAGA,yBAAM,GAAAC,aAAI,EAACJ,CAAI,CAACL,QAAQ,CAAC,uEAGzBD,CAAgB,CAACE,OAAO,MAEtB,4BAA4B,CAC5B,MAAM,CACNI,CAAI,CAACK,QAAQ,CACbL,CAAI,CAACM,QAAQ,CACd,6EAGN,EAAC,CACH,EAEIR,CACT,CAAC,CAAE,EAAE,CAAC,UACA,GAAAS,YAAG,EAACT,CAAK,CAAC,qCAzBRD,CAAe,EA0BxB,EAELd,CAAc,CAACyB,GAAG,CAACb,CAAQ,CAC7B,CAMuE,CAAEN,QAAQ,GAAO,CAAEC,UAAU,GAAO,CAAC,CAAC,CAEtGT,CACT"}